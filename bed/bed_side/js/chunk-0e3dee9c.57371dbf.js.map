{"version":3,"sources":["webpack:///./src/assets/nurse_head_animation.gif","webpack:///./src/views/patient/Dialing.vue?28eb","webpack:///./src/views/patient/Dialing.vue?27ff","webpack:///src/views/patient/Dialing.vue","webpack:///./src/views/patient/Dialing.vue?cf15","webpack:///./src/views/patient/Dialing.vue","webpack:///./src/assets/nurse_head_big.png","webpack:///./src/assets/patient_dialing_connected.gif"],"names":["module","exports","render","_vm","this","_h","$createElement","_c","_self","attrs","staticClass","directives","name","rawName","value","isConnected","expression","_e","style","color","_v","_s","isCalling","timer","visibility","on","hangup","staticRenderFns","data","hour","min","second","canClick","computed","created","$route","query","isCalled","$isCalled","$callchannelId","channelId","$callerCode","callerCode","called","window","plus","voice_call","console","log","res","registSocketListener","mounted","app","methods","onSocketMessage","socketData","code","voiceError_callback","voice_callback","calledCode","getMac","callStatus","webSocket_sendMsg","backCmdJson","$currentCall","deviceCode","deviceCancel","call","post","$channelId","voice_end","calling","clearTimeout","callingTimer","setInterval","component"],"mappings":"mGAAAA,EAAOC,QAAU,IAA0B,yC,oCCA3C,yBAAwf,EAAG,G,yCCA3f,IAAIC,EAAS,WAAa,IAAIC,EAAIC,KAASC,EAAGF,EAAIG,eAAmBC,EAAGJ,EAAIK,MAAMD,IAAIF,EAAG,OAAOE,EAAG,MAAM,CAACE,MAAM,CAAC,GAAK,QAAQ,CAACF,EAAG,MAAM,CAACG,YAAY,YAAY,CAACH,EAAG,MAAM,CAACG,YAAY,cAAc,CAACH,EAAG,MAAM,CAACI,WAAW,CAAC,CAACC,KAAK,OAAOC,QAAQ,SAASC,OAAQX,EAAIY,YAAaC,WAAW,iBAAiBN,YAAY,yBAAyBD,MAAM,CAAC,IAAM,EAAQ,WAA4CF,EAAG,MAAM,CAACI,WAAW,CAAC,CAACC,KAAK,OAAOC,QAAQ,SAASC,MAAOX,EAAe,YAAEa,WAAW,gBAAgBN,YAAY,iBAAiBD,MAAM,CAAC,IAAM,EAAQ,WAAuCN,EAAe,YAAEI,EAAG,MAAM,CAACG,YAAY,mBAAmBD,MAAM,CAAC,IAAM,EAAQ,WAAiDN,EAAIc,OAAOV,EAAG,IAAI,CAACG,YAAY,gBAAgBQ,MAAM,CAAEC,MAAMhB,EAAIY,YAAc,UAAY,YAAa,CAACZ,EAAIiB,GAAGjB,EAAIkB,GAAGlB,EAAIY,YAAeZ,EAAImB,UAAY,MAAQ,QAAW,eAAef,EAAG,IAAI,CAACG,YAAY,iBAAiB,CAACP,EAAIiB,GAAGjB,EAAIkB,GAAGlB,EAAIoB,UAAUhB,EAAG,SAAS,CAACG,YAAY,cAAcQ,MAAM,CAAEM,YAAYrB,EAAIY,aAAeZ,EAAImB,UAAY,UAAY,UAAWG,GAAG,CAAC,MAAQtB,EAAIuB,SAAS,CAACvB,EAAIiB,GAAG,aACtmCO,EAAkB,G,wBC+BtB,GACEC,KAAM,WACJ,MAAO,CACLb,aAAa,EACbO,WAAW,EACXO,KAAM,EACNC,IAAK,EACLC,OAAQ,EACRC,UAAN,IAGEC,SAAU,CACRV,MADJ,WAEM,OAAInB,KAAKW,aAAeX,KAAKkB,UACpB,GAAf,yGAEe,UAIbY,QApBF,WAoBA,WACQ9B,KAAK+B,OAAOC,MAAMC,UACpBjC,KAAKkC,UAA2C,MAA/BlC,KAAK+B,OAAOC,MAAMC,SACnCjC,KAAKmC,eAAiBnC,KAAK+B,OAAOC,MAAMI,UACxCpC,KAAKqC,YAAcrC,KAAK+B,OAAOC,MAAMM,WACrCtC,KAAKuC,SACLC,OAAOC,KAAKC,WAAW1C,KAAKmC,iBAE5B,OAAN,OAAM,CAAN,wCACQ,EAAR,aACQQ,QAAQC,IAAI,OAASR,GAErB,OAAR,OAAQ,CAAR,wCACUO,QAAQC,IAAI,YAAaC,GACzB,EAAV,mBACA,YACU,OAAV,OAAU,CAAV,MAEQL,OAAOC,KAAKC,WAAWN,MAC/B,YACQ,OAAR,OAAQ,CAAR,MAGII,OAAOC,KAAKK,wBAEdC,QA7CF,WA6CA,WAEI,GAAJ,eACM,KAAN,YACM,IAAN,0BACQ,EAAR,YACA,mBACA,KAEIP,OAAOQ,IAAMhD,MAEfiD,QAAS,CACPC,gBADJ,SACA,GACM,IAAN,gBAEM,OADAP,QAAQC,IAAIO,GACJA,EAAWC,MACjB,IAAK,OACb,OACA,YACA,MACA,6BACA,gCACA,2BACA,eAGA,6BACA,iDACA,MAEQ,IAAK,SACb,oBACA,0BAEA,uBACA,wBACA,oBACA,MAEQ,IAAK,WAMb,OALA,4DACA,oDACA,oBACA,0BAEA,mBACA,QACA,eACA,MAEA,QACA,uBACA,wBACA,oBACA,MAEA,QACA,uBACA,wBACA,oBACA,uBACA,MAEA,QACA,QACA,QACA,uBACA,6BACA,wBACA,oBACA,MAEA,QACA,uBACA,wBACA,oBACA,MAEA,QAEA,wBACA,oBACA,gCACA,MAEA,QACA,MAGA,QAIIC,oBAlFJ,SAkFA,GACM,OAAN,OAAM,CAAN,IAGIC,eAtFJ,WAsFA,WAEM,GADAX,QAAQC,IAAI,UAAW5C,KAAKkC,WACxBlC,KAAKkC,UAAW,CAClB,IAAR,kBACUkB,KAAM,OACN5B,KAAM,CACJY,UAAWpC,KAAKmC,eAChBG,WAAYtC,KAAKqC,YACjBkB,WAAYf,OAAOC,KAAKe,SACxBC,WAAY,OAGhBjB,OAAOC,KAAKiB,kBAAkBC,GAC9B3D,KAAK4D,aAAe,CAClBC,WAAYrB,OAAOC,KAAKe,SACxBpB,UAAWpC,KAAKmC,qBAGlB,OAAR,OAAQ,CAAR,wDACUQ,QAAQC,IAAI,OAAQC,GACpB,EAAV,mBAIIiB,aA9GJ,WA8GA,WAEM9D,KAAK+D,KAAKC,KAAK,eAAgB,CAC7BH,WAAYrB,OAAOC,KAAKe,SACxBpB,UAAWpC,KAAKiE,aACxB,kBAC8B,IAAlBpB,EAAIrB,KAAK4B,MACX,EAAV,kBAKMZ,OAAOC,KAAKyB,aAGdC,QA7HJ,WA6HA,WACMnE,KAAKW,aAAc,EACnB,IAAN,yBACQyD,aAAaC,GACb,EAAR,aACQC,aAAY,WACpB,KAAc,EAAd,QACY,EAAZ,SACY,EAAZ,OAEY,EAAZ,WAEA,OACA,MAGI/B,OA7IJ,WA6IA,WACMvC,KAAKkB,WAAY,EACjBlB,KAAKW,aAAc,EACnB2D,aAAY,WAClB,KAAY,EAAZ,QACU,EAAV,SACU,EAAV,OAEU,EAAV,WAEA,MAIIhD,OA3JJ,WA2JA,WACM,GAAN,eAKA,GAJQkB,OAAOC,KAAKyB,YACpB,oBACA,2BAEA,kBAEA,YADA,oBAGA,iBACA,iEACA,iBACA,oBAMA,wBCtQgW,I,wBCQ5VK,EAAY,eACd,EACAzE,EACAyB,GACA,EACA,KACA,WACA,MAIa,aAAAgD,E,8BCnBf3E,EAAOC,QAAU,IAA0B,mC,4CCA3CD,EAAOC,QAAU,IAA0B","file":"js/chunk-0e3dee9c.57371dbf.js","sourcesContent":["module.exports = __webpack_public_path__ + \"img/nurse_head_animation.a4b39ca4.gif\";","import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Dialing.vue?vue&type=style&index=0&id=1ed5f944&scoped=true&lang=css&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Dialing.vue?vue&type=style&index=0&id=1ed5f944&scoped=true&lang=css&\"","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{attrs:{\"id\":\"con\"}},[_c('div',{staticClass:\"main-div\"},[_c('div',{staticClass:\"nurse-head\"},[_c('img',{directives:[{name:\"show\",rawName:\"v-show\",value:(!_vm.isConnected),expression:\"!isConnected\"}],staticClass:\"nurse-head-img-dialing\",attrs:{\"src\":require(\"../../assets/nurse_head_animation.gif\")}}),_c('img',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.isConnected),expression:\"isConnected\"}],staticClass:\"nurse-head-img\",attrs:{\"src\":require(\"../../assets/nurse_head_big.png\")}}),(_vm.isConnected)?_c('img',{staticClass:\"nurse-head-statu\",attrs:{\"src\":require(\"../../assets/patient_dialing_connected.gif\")}}):_vm._e()]),_c('p',{staticClass:\"nurse-dialing\",style:({color:_vm.isConnected ? '#27d88b' : '#333333'})},[_vm._v(_vm._s(_vm.isConnected ? (_vm.isCalling ? '已接通' : '护士已接收') : '呼叫护士中...'))]),_c('p',{staticClass:\"nurse-waiting\"},[_vm._v(_vm._s(_vm.timer))]),_c('button',{staticClass:\"hang-up-btn\",style:({visibility:!_vm.isConnected || _vm.isCalling ? 'visible' : 'hidden'}),on:{\"click\":_vm.hangup}},[_vm._v(\"挂断\")])])])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <div id=\"con\">\n    <div class=\"main-div\">\n      <div class=\"nurse-head\">\n        <img\n          class=\"nurse-head-img-dialing\"\n          src=\"../../assets/nurse_head_animation.gif\"\n          v-show=\"!isConnected\"\n        />\n        <img class=\"nurse-head-img\" src=\"../../assets/nurse_head_big.png\" v-show=\"isConnected\" />\n        <img\n          class=\"nurse-head-statu\"\n          src=\"../../assets/patient_dialing_connected.gif\"\n          v-if=\"isConnected\"\n        />\n      </div>\n      <p\n        class=\"nurse-dialing\"\n        :style=\"{color:isConnected ? '#27d88b' : '#333333'}\"\n      >{{isConnected ? (isCalling ? '已接通' : '护士已接收') : '呼叫护士中...'}}</p>\n      <p class=\"nurse-waiting\">{{timer}}</p>\n      <button\n        class=\"hang-up-btn\"\n        :style=\"{visibility:!isConnected || isCalling ? 'visible' : 'hidden'}\"\n        @click=\"hangup\"\n      >挂断</button>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { playSound, showMessage, joinChannel, establishPhoneCall } from '../../utils/utils'\nexport default {\n  data: function () {\n    return {\n      isConnected: false,\n      isCalling: false,\n      hour: 0,\n      min: 0,\n      second: 0,\n      canClick:true\n    }\n  },\n  computed: {\n    timer () {\n      if (this.isConnected && this.isCalling) {\n        return `${('0000000000000000' + this.min).substr(-2)}:${('0000000000000000' + this.second).substr(-2)}`\n      } else {\n        return '请耐心等待'\n      }\n    }\n  },\n  created () {\n    if (this.$route.query.isCalled) {\n      this.$isCalled = this.$route.query.isCalled === '1'\n      this.$callchannelId = this.$route.query.channelId\n      this.$callerCode = this.$route.query.callerCode\n      this.called()\n      window.plus.voice_call(this.$callchannelId)\n    } else {\n      joinChannel(window.plus.getMac()).then(channelId => {\n        this.$channelId = channelId\n        console.log('加入通道' + channelId)\n        // 加入通道\n        playSound('/sound/ring.wav', true).then(res => {\n          console.log('playVoice', res)\n          this.$voiceHandler = res\n        }, err => {\n          showMessage(err)\n        })\n        window.plus.voice_call(channelId)\n      }, err => {\n        showMessage(err)\n      })\n    }\n    window.plus.registSocketListener()\n  },\n  mounted () {\n    //按钮挂断状态\n    if(this.canClick){\n       this.canClick = false;\n        var a=setInterval(()=>{\n            this.canClick = true;\n       \t\t\tclearInterval(a)    \n     }, 2000); \n    }\n    window.app = this;\n  },\n  methods: {\n    onSocketMessage (msg) {\n      const socketData = JSON.parse(msg)\n      console.log(socketData)\n      switch (socketData.code) {\n        case 'CALL': {\n          const jsonObj = {\n            code: 'BACK',\n            data: {\n              callerCode: socketData.data.callerCode,\n              calledCode: window.plus.getMac(),\n              channelId: socketData.data.channelId,\n              callStatus: 7\n            }\n          }\n          console.log('呼叫中...',socketData.data)\n          window.plus.webSocket_sendMsg(JSON.stringify(jsonObj))\n          break\n        }\n        case 'CANCEL': {\n          if (this.$voiceHandler) {\n            this.$voiceHandler.stop()\n          }\n          this.$currentCall = null\n          window.plus.voice_end()\n          this.$router.go(-1)\n          break\n        }\n        case 'CALLBACK': {\n          console.log(this.$voiceHandler, Boolean(this.$voiceHandler))\n          console.log('位于呼叫', socketData.data.callStatus, '全部数据', socketData.data)\n          if (this.$voiceHandler) {\n            this.$voiceHandler.stop()\n          }\n          switch (socketData.data.callStatus) {\n            case '2': {\n              this.calling()\n              break\n            }\n            case '3': {\n              this.$currentCall = null\n              window.plus.voice_end()\n              this.$router.go(-1)\n              break\n            }\n            case '4': {\n              this.$currentCall = null\n              window.plus.voice_end()\n              this.$router.go(-1)\n              showMessage('呼叫超时')\n              break\n            }\n            case '5':\n            case '6':\n            case '7': {\n              this.$currentCall = null\n              showMessage('呼叫繁忙,请稍后再试')\n              window.plus.voice_end()\n              this.$router.go(-1)\n              break\n            }\n            case '8': {\n              this.$currentCall = null\n              window.plus.voice_end()\n              this.$router.go(-1)\n              break\n            }\n            case '9': {\n              // 卫浴呼叫占线中\n              window.plus.voice_end()\n              this.$router.go(-1)\n              showMessage('呼叫卫浴报警中,请稍后再试')\n              break\n            }\n            default: {\n              break\n            }\n          }\n          break\n        }\n      }\n    },\n    voiceError_callback (err) {\n      showMessage(err)\n    },\n    // 语音call成功加入回调\n    voice_callback () {\n      console.log('通道加入成功：', this.$isCalled)\n      if (this.$isCalled) {\n        const backCmdJson = JSON.stringify({\n          code: 'BACK',\n          data: {\n            channelId: this.$callchannelId,\n            callerCode: this.$callerCode,\n            calledCode: window.plus.getMac(),\n            callStatus: '2'\n          }\n        })\n        window.plus.webSocket_sendMsg(backCmdJson)\n        this.$currentCall = {\n          deviceCode: window.plus.getMac(),\n          channelId: this.$callchannelId\n        }\n      } else {\n        establishPhoneCall(window.plus.getMac(), this.$channelId).then(res => {\n          console.log('当前呼叫', res)\n          this.$currentCall = res\n        })\n      }\n    },\n    deviceCancel () {\n      // 呼叫取消\n      this.call.post('deviceCancel', {\n        deviceCode: window.plus.getMac(),\n        channelId: this.$channelId\n      }).then(res => {\n        if (res.data.code === 1) {\n          this.$router.go(-1)\n        } else {\n          // this.error(res.data.msg)\n        }\n      })\n      window.plus.voice_end()\n    },\n    // 呼叫通话中，呼叫和被呼都是这个界面\n    calling () {\n      this.isConnected = true\n      const callingTimer = setTimeout(() => {\n        clearTimeout(callingTimer)\n        this.isCalling = true\n        setInterval(() => {\n          if (this.second === 59) {\n            this.second = 0\n            this.min++\n          } else {\n            this.second++\n          }\n        }, 1000)\n      }, 3000)\n    },\n\n    called () {\n      this.isCalling = true\n      this.isConnected = true\n      setInterval(() => {\n        if (this.second === 59) {\n          this.second = 0\n          this.min++\n        } else {\n          this.second++\n        }\n      }, 1000)\n    },\n\n    // 患者挂断通话\n    hangup () {\n      if(this.canClick){   //为true能实现挂断\n        window.plus.voice_end()\n      if (this.$voiceHandler) {\n        this.$voiceHandler.stop()\n      }\n      if (!this.$currentCall) {\n        this.$router.go(-1)\n        return\n      }\n      if (this.isConnected) {\n        this.call.post('deviceExit', this.$currentCall).then(res => {\n          if (res.data.code === 1) {\n            this.$router.go(-1)\n          } else {\n            // this.error(res.data.msg)\n          }\n        })\n      } else {\n        this.deviceCancel()\n      }\n      }\n    }\n\n    // 呼叫出错\n    /* error (error) {\n      showMessage(error, () => {\n        plus.removePage(pageTag);\n      });\n    } */\n  }\n}\n</script>\n\n<style scoped>\n.main-div {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n}\n\n.nurse-head {\n  width: 460px;\n  height: 460px;\n  position: relative;\n}\n\n.nurse-head-img-dialing {\n  width: 100%;\n  height: 100%;\n  border-radius: 50%;\n}\n\n.nurse-head-img {\n  width: 300px;\n  height: 300px;\n  border-radius: 50%;\n  position: absolute;\n  top: 80px;\n  left: 80px;\n}\n\n.nurse-head-statu {\n  width: 90px;\n  height: 90px;\n  position: absolute;\n  top: 320px;\n  left: 270px;\n}\n\n.nurse-dialing {\n  font-size: 42px;\n  font-weight: bold;\n  margin-top: 15px;\n  line-height: 56px;\n}\n\n.nurse-waiting {\n  font-size: 30px;\n  color: #333333;\n  margin-top: 35px;\n  line-height: 34px;\n}\n\n.hang-up-btn {\n  width: 500px;\n  height: 72px;\n  border-radius: 10px;\n  background-color: #fe384b;\n  color: white;\n  font-size: 30px;\n  margin-top: 100px;\n}\n</style>\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Dialing.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Dialing.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Dialing.vue?vue&type=template&id=1ed5f944&scoped=true&\"\nimport script from \"./Dialing.vue?vue&type=script&lang=js&\"\nexport * from \"./Dialing.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Dialing.vue?vue&type=style&index=0&id=1ed5f944&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"1ed5f944\",\n  null\n  \n)\n\nexport default component.exports","module.exports = __webpack_public_path__ + \"img/nurse_head_big.9f7a9500.png\";","module.exports = __webpack_public_path__ + \"img/patient_dialing_connected.c5675f2a.gif\";"],"sourceRoot":""}